# Структура проекта SQLRC на Pascal

В этом документе представлена структура проекта SQLRC на Pascal, включая основные модули и их функциональность.

## Основные модули

1. **Главный модуль (sqlrc.dpr)** - Точка входа в приложение, координирует работу всех модулей
2. **Модуль типов данных (src/types.pas)** - Определяет все типы данных, используемые в проекте
3. **Модуль файловой системы (src/fs.pas)** - Отвечает за чтение и запись файлов
4. **Модуль парсинга (src/parse/)** - Содержит функции для парсинга SQL-кода
   - Парсер схемы (src/parse/schema.pas)
   - Парсер запросов (src/parse/query/parse.pas)
   - Парсер параметров (src/parse/query/params.pas)
   - Парсер результатов (src/parse/query/result.pas)
5. **Модуль генерации (src/generate/)** - Содержит функции для генерации кода
   - Генератор схемы (src/generate/schema.pas)
   - Генератор запросов (src/generate/query.pas)
   - Генераторы для разных типов запросов (src/generate/return/)
     - Генератор для one (src/generate/return/one.pas)
     - Генератор для many (src/generate/return/many.pas)
     - Генератор для exec (src/generate/return/exec.pas)

## Алгоритм работы

1. Чтение и парсинг конфигурационного файла
2. Чтение файлов схемы и запросов
3. Парсинг схемы SQL
4. Генерация кода схемы
5. Запись сгенерированного кода схемы в файл
6. Парсинг запросов SQL
7. Парсинг параметров запросов
8. Парсинг результатов запросов
9. Генерация кода запросов
10. Запись сгенерированного кода запросов в файл

## Особенности реализации

### Работа с текстовыми шаблонами

В Pascal нет встроенной поддержки регулярных выражений, поэтому мы будем использовать функции для обработки текста:

- Функции для поиска и замены подстрок
- Функции для разделения строк на части
- Функции для удаления пробелов
- Функции для проверки начала и конца строки
- Функции для извлечения подстрок

### Работа с конфигурационным файлом

Вместо JSON мы будем использовать простой текстовый формат "key:value\n" для конфигурационного файла:

```
schema:schema.sql
queries:user.sql
remove_trailing_s:true
pakage.name:gen
pakage.path:./__gen/
```

### Работа с файлами

В Pascal есть встроенные средства для работы с файлами, которые мы будем использовать для чтения и записи файлов:

- Функции для чтения файлов в строки
- Функции для записи строк в файлы
- Функции для создания директорий

### Генерация кода

Для генерации кода мы будем использовать строковые функции и шаблоны:

- Функции для форматирования строк
- Функции для объединения строк
- Функции для преобразования типов данных

## Следующие шаги

1. Создание структуры проекта и определение типов данных
2. Реализация модуля файловой системы
3. Реализация парсера схемы
4. Реализация генератора схемы
5. Реализация парсера запросов
6. Реализация парсера параметров запросов
7. Реализация парсера результатов запросов
8. Реализация генератора запросов
9. Реализация генераторов для разных типов запросов
10. Интеграция всех модулей в главный модуль
11. Тестирование и отладка
